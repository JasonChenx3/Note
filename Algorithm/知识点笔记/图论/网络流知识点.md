#### 流网络

$G=(V,E)$ 是一个有向图，图中每条边 $(u,v) \in E$ 有一个非负的容量值 $c(u,v) \ge 0$ 。

在流网络的所有结点中，有两个特殊的结点：源结点 $s$ 和汇点 $t$ 。

如果边集合 $E$ 包含一条边 $(u,v)$ ，则图中不存在反方向的边 $(v,u)$ 。

如果 $(u,v) \notin E$ ，定义 $c(u,v)=0$ 。

#### 可行流

可行流是满足一定条件的网络流，满足下面限制条件：

- 容量限制：对于所有的结点 $u,v \in V$ ， $0 \le f(u,v) \le c(u,v)$ 。
- 流量守恒：对于所有结点 $u \in V-\{s,t\}$ ，要求 $\sum_{v \in V} f(v, u) = \sum_{v \in V} f(u, v)$ 。

非负数值 $f(u, v)$ ：从结点 $u$ 到结点 $v$ 的流。

一个流 $f$ 的值 $|f|$ 定义为： $|f|= \sum _{v \in E} f(s,v) - \sum _{v \in E} f(v,s)$ ，即 $s$ 的净流出量。

最大流是指最大的可行流。

#### 残留容量与残留网络

残留网络 $G_f$ 类似于一个容量为 $c_f$ 的流网络，但 $G_f$ 还包含所有的反向边，残留网络被可行流 $f$ 所决定，一个可行流对应一个残留网络。

残存容量 $c_f$ 定义：
$$
c_f(u,v) = \left\{\begin{matrix}
 c(u,v)-f(u,v),\ 若(u,v) \in E\\
 f(v, u),\ 若(v,u) \in E\\
0, \ 其他
\end{matrix}\right.
$$
$f + f'$ 也是原网络的可行流。

> 证明：
>
> $+$ 含义为边的方向相同流量相加，反之相减。
>
> 只需证明 $f+f'$ 满足可行流的两个限制条件。
>
> 先证明满足容量限制：
>
> 考虑结点 $u$ 和结点 $v$ ，设原流量为 $f(u,v)$ 。
>
> - 方向相同
>   - $0 \le f(u,v) \le c(u,v)$
>   -  $0 \le f'(u,v) \le c_f(u,v) = c(u,v) - f(u,v)$ 
>   - 则 $0 \le f(u,v) + f'(u,v) \le c(u,v)$ ，满足容量限制。
> - 方向相反
>   - $0 \le f(u,v) \le c(u,v)$ 
>   - $0 \le f'(v,u) \le f(u,v)$ 
>   - 则 $0 \le f(u,v) - f'(v,u) \le c(u,v)$ ，满足容量限制。
>
> 再证明满足流量守恒：
>
> 考虑结点 $u$ 。
>
> 在 $f$ 中，$u$ 满足流量守恒。
>
> 在 $f'$ 中，$u$ 满足流量守恒。
>
> 所以，$u$ 的流入量相加，$u$ 的流出量相加，仍满足流量守恒。

$|f'+f| = |f'| + |f|$ 。

> 证明：
>
> 考虑源节点 $s$ 。
>
> 在 $f$ 中，$s$ 的净流出量为 $|f|$ 。
>
> 在 $f'$ 中，$s$ 的净流出量为 $|f'|$ 。
>
> 所以，在 $f + f'$ 中，$s$ 的净流出量为 $|f| + |f'|$ 。

#### 增广路径

增广路径是在残留网络中的一条 $|f'| > 0$ 的路径。

#### 割

割的定义：

- 割是网络中顶点的划分，把所有点划分成两个顶点集合 $S$ 和 $T$ ，源点属于 $S$ ，汇点属于 $T$ ，记作 $CUT(S,T)$ 。

割边：

- 一条弧的两个顶点一个属于 $S$ ，一个属于 $T$ ，这条弧为割 $CUT(S,T)$ 的一条割边。
- 从 $S$ 指向 $T$ 的为正向割边。
- 从 $T$ 指向 $S$ 的为反向割边。

割的容量 $c$ ：

-  $c(S,T) = \sum_{u \in S} \sum_{v \in T} c(u,v)$ ，不考虑反向边，所有正向割边的容量和。
- 最小割是指==容量最小==的割。

割的流量 $f$ ：

- $f(S,T) = \sum_{u \in S} \sum_{v \in T} f(u,v) - \sum_{u \in S} \sum_{v \in T} f(v, u)$ ，$S$ 到 $T$ 的流量之和减去 $T$ 到 $S$ 的流量之和。
  - 性质：
  - $f(X,Y) = -f(Y,X)$ 。
  - $f(X,X) = 0$ 。
  - $f(Z,X \cup Y) = f(Z,X) + f(Z,Y)$ ，当 $X \cap Y = \empty$ 。
  - $f(X \cup Y, Z) = f(X, Z) + f(Y, Z)$ ，当 $X \cap Y = \empty$ 。

对于任意割，任意可行流，$f(S,T) \le c(S,T)$ 。

> 证明：
>
> $f(S,T)  \le \sum_{u \in S} \sum_{v \in T} f(u,v)$ ，
>
> 因为是可行流，则有 $f(u,v) \le c(u,v)$ ，
>
> 则 $\sum_{u \in S} \sum_{v \in T} f(u,v) \le \sum_{u \in S} \sum_{v \in T} c(u,v)$ ，
>
> 所以 $f(S,T) \le c(S,T)$ 。

对于任意割，任意可行流，$|f| = f(S,T)$ 。

> 证明：
>
> 因为 $S \cup T = V$ ，$S \cap T = \empty$ ，
>
> 则 $f(S, V) = f(S, S) + f(S, T)$ ，
>
> 则 $f(S, V) = f(S, T)$ ，
>
> 又因为 $f(S, V) = f(\{s\}, V), f(S - \{s\}, V)$ ，
>
> 又有 $f(S - \{s\}, V) = \sum_{u \in S - \{s\}}  \sum_{v \in V} f(u,v) - \sum_{u \in S - \{s\}}  \sum_{v \in V} f(v,u) = 0$ ，
>
> 所以 $f(S,V) = f(\{s\}, V) = |f|$ 。

对于任意可行流，任意割，$|f| \le c(S,T)$ ，最大流 $\le$ 最小割。

#### 最大流最小割定理

- 可行流 $f$ 是最大流。

- 可行流 $f$ 的残留网络中不存在增广路。
- 存在某个割 $[S,T]$ ，$|f|=c(S,T)$ 。 

> 证明：
>
> 1 推 2：
>
> 使用反证法，
>
> 如果 $f$ 为最大流，并且存在一个 $G_f$ ，其 $|f'| > 0$ ，
>
> 则 $|f + f'| = |f| + |f'| > |f|$ ，矛盾，得证。
>
> 3 推 1：
>
> 因为 $|f| \le c(S, T)$ ，则最大流 $\le$  $c(S,T)$ ，
>
> 又因为，最大流 $\ge |f|$ ，
>
> 又有，$|f| = c(S, T) \ge$ 最大流，
>
> 所以 $f=$ 最大流。
>
>  因为，最大流 $\le$ 最小割，
>
> 则，最小割 $\le c(S, T) = |f| \le $ 最大流，
>
> 所以，最小割 = 最大流。
>
> 2 推 3：
>
> 设 $S$ 为在 $G_f$ 中，从 $s$ 出发沿容量大于 $0$ 的边走，所以能走到的点；$T = V - S$ ，
>
>  则 $x \in S, y \in T, f(x,y) = c(x,y), f(y,x) = 0$ ，
>
> 所以 $|f| = f(S, T) = \sum_{u \in S} \sum_{v \in T}f(u,v) - \sum_{u \in S} \sum_{v \in T}f(v, u) = c(S, T)$ ，得证。 