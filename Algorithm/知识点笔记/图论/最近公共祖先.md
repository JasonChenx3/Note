### 最近公共祖先

**定义**

 对于有根树 $T$ 的两个结点 $u$ 、$v$ ，最近公共祖先 $LCA(T,u,v)$ 表示一个结点 $x$ ，满足 $x$ 是 $u$ 和 $v$ 的祖先且 $x$ 的深度尽可能大。在这里，一个节点也可以是它自己的祖先。  



**方法**

- 向上标记法 $O(n)$ (不常用)

- ==倍增==

  1. `f[i, j]` ：从 $i$ 开始走，向上走 $2^j$ 步能走到的 节点。$(0 \le j \le logn)$

  2. `depth[i]` ：表示深度。

  

  哨兵：

  如果从 $i$ 开始跳 $2^j$ 步会跳过根节点，那么 `fa[i, j] = 0` 。`depth[0] = 0` 。

  

  步骤：

  - 先将两个点跳到同一层。
  - 让两个点同时往上跳，一直跳到最近公共祖先的下一层。
  - 查询 $O(logn)$ 
  - 预处理 $O(nlogn)$



- $Tarjan$ ：$O(n+m)$

  在深度优先遍历时，将所有点分成三大类。

  - 以及遍历过，且回溯过的点
  - 正在搜素的分支
  - 还未搜索到的点 