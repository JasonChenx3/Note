## 多重背包

### 描述

 给定 $N$ 种物品，每种物品都有重量 $w_i$ 和价值 $v_i$ ，第 $i$ 种物品有 $C_i$ 个 ($C_i \ge 1$) 。

背包容量为 $M$ ，求解在不超过背包容量的情况下如何放置物品，可以使背包中物品的价值之和最大。



### 方法一：暴力拆分

时间复杂度：$O(NM \sum c_i)$

暴力拆分指将第 $i$ 种物品看作 $C_i$ 种独立的物品，每种物品只有一 个，转化为01背包问题。

#### 代码

```cpp
void multi_pack1(int n, int m) {  //n 物品个数，m 背包容量
    for (int i = 1; i <= n; i ++ )
        for (int k = 1; k <= c[i]; k ++ )
            for (int j = m; j >= v[i]; j -- )
                f[j] = max(f[j], f[j - v[i]] + w[i]);
}
```



### 方法二：二进制优化枚举

时间复杂度：$O(NM \sum log_{\Large c_i})$

当物品满足 $C[i ]×v[i ]≥W$ 时，可以认为这种物品是不限数量的，按照完全背包的方法求解即可；

否则可以采用二进制拆分，将 $C[i ]$ 个物品拆分成若干种新物品。 

将第 $i$ 种物品分成若干件 01 背包中的物品，其中每件物品有一个系数。

这件物品的费用和价值均是原来的费用和价值乘以这个系数。

令这些系数分别为 $1, 2, 2^2 . . . 2^{k−1},Ci−2^k + 1$ ，且 $k$ 是满足 $C_i−2^k+1>0$ 的最大整数。 

例如，

如果 $C_i=13$ ，则相应的 $k=3$ ， 这种最多取 $13$ 件的物品应被分成系数分别为 $1, 2, 4, 6$ 的四件物品。

分成的这几件物品的系数和为 $C_i$，表明不可能取多于 $C_i$ 件的第 $i$ 种物品。

另外 这种方法也能保证对于 $0 . . . C_i$ 间的每一个整数，均可以用若干个系数的和表示。  

#### 代码

```cpp
void multi_pack2(int n, int m) {
    if (c[i] * v[i] >= m) {  //可视为完全背包的情况
        for (int j = v[i]; j <= m; j ++ ) 
            f[j] = max(f[j], f[j - v[i]] + w[i]);
    } else {  
        for (int k = 1; k <= c[i]; k <<= 1) {  //二进制优化枚举
            int x = min(k, c[i]);
			for (int j = m; j >= k * v[i]; j -- ) 
                f[j] = max(f[j], f[j - k * v[i]] + w[i]);
            c[i] -= x;
        }
    }
}
```

